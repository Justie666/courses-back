generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  email    String @unique
  name     String
  password String
  role     Role   @default(USER)

  ratingCourse        RatingCourse[]
  requestBackCall     RequestBackCall[]
  userFavoriteCourse  UserFavoriteCourse[]
  userWatchedLesson   UserWatchedLesson[]
  userPurchasedCourse UserPurchasedCourse[]

  @@map("user")
}

model Category {
  id             String           @id @default(cuid())
  createdAt      DateTime         @default(now()) @map("created_at")
  updatedAt      DateTime         @updatedAt @map("updated_at")
  title          String           @unique
  courseCategory CourseCategory[]

  @@map("category")
}

model Course {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  title String @unique
  price Int    @default(0)
  image String @default("")
  slug  String @unique

  courseCategory      CourseCategory[]
  lessons             Lesson[]
  ratingCourse        RatingCourse[]
  userFavoriteCourse  UserFavoriteCourse[]
  userPurchasedCourse UserPurchasedCourse[]

  @@map("course")
}

model CourseCategory {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  categoryId String   @map("category_id")
  courseId   String   @map("course_id")
  Category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  Course     Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@map("course_category")
}

model RatingCourse {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  userId   String? @map("user_id")
  courseId String? @map("course_id")
  Course   Course? @relation(fields: [courseId], references: [id])
  User     User?   @relation(fields: [userId], references: [id])

  @@map("rating_course")
}

model UserFavoriteCourse {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  userId   String? @map("user_id")
  courseId String? @map("course_id")
  Course   Course? @relation(fields: [courseId], references: [id])
  User     User?   @relation(fields: [userId], references: [id])

  @@map("user_favorite_course")
}

model UserPurchasedCourse {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  userId   String? @map("user_id")
  courseId String? @map("course_id")
  Course   Course? @relation(fields: [courseId], references: [id])
  User     User?   @relation(fields: [userId], references: [id])

  @@map("user_purchased_course")
}

model UserWatchedLesson {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  User     User?   @relation(fields: [userId], references: [id])
  userId   String? @map("user_id")
  Lesson   Lesson? @relation(fields: [lessonId], references: [id])
  lessonId String? @map("lesson_id")

  @@map("user_watched_lesson")
}

model RequestBackCall {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  userId  String                @map("user_id")
  status  StatusRequestBackCall @default(PENDING)
  comment String                @default("")
  phone   String
  user    User                  @relation(fields: [userId], references: [id])

  @@map("request_back_call")
}

model Lesson {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  title String
  video String @default("")
  slug  String

  userWatchedLesson UserWatchedLesson[]

  courseId String? @map("course_id")
  Course   Course? @relation(fields: [courseId], references: [id])

  @@map("lesson")
}

enum Role {
  USER
  ADMIN
}

enum StatusRequestBackCall {
  PENDING
  ACCEPT
  REJECT
}
